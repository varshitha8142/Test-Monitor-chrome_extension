import"../../../assets/js/modulepreload-polyfill.0c213636.js";import{r as t,a as h,j as o,c as b}from"../../../assets/js/jsx-runtime.28b60716.js";function S(){const[a,l]=t.exports.useState(null),[p,e]=t.exports.useState(null),[s,c]=t.exports.useState(null),[n,r]=t.exports.useState(null),[i,m]=t.exports.useState(null),[d,v]=t.exports.useState(0);return t.exports.useEffect(()=>{(async()=>{const g=await navigator.mediaDevices.getUserMedia({audio:!0}),u=new AudioContext,f=u.createMediaStreamSource(g),x=u.createAnalyser();x.fftSize=256;const w=new Uint8Array(x.frequencyBinCount);f.connect(x),e(g),l(u),c(f),r(x),m(w)})()},[]),t.exports.useEffect(()=>{const g=setInterval(()=>{if(n&&i){n.getByteFrequencyData(i);const u=Math.max(...i),f=Math.max(u/255,d*.95);v(f)}},50);return()=>clearInterval(g)},[n,i,d]),h("div",{children:[h("div",{children:["Max level: ",d.toFixed(2)]}),h("div",{style:{display:"flex",flexDirection:"row",height:"20px",backgroundColor:"gray",borderRadius:"20px"},children:[o("div",{style:{flex:d,height:"100%",backgroundColor:"red",borderRadius:"20px"}}),o("div",{style:{flex:1-d,height:"100%",backgroundColor:"gray"}})]})]})}const A=()=>{const a=t.exports.useRef(null);t.exports.useEffect(()=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{a.current&&(a.current.srcObject=e)}).catch(e=>{console.log(e)})},[]);const l=async()=>{const e=document.createElement("canvas");e.width=a.current.videoWidth,e.height=a.current.videoHeight,e.getContext("2d").drawImage(a.current,0,0,e.width,e.height);const s=e.toDataURL("image/jpeg"),c=p(s),n=new FormData;n.append("file",c,"image.jpg");try{const i=(await fetch("http://localhost:3000/image",{method:"POST",body:n})).json();console.log(i)}catch(r){console.log(r)}};t.exports.useEffect(()=>{const e=setInterval(()=>{l()},6e4);return()=>clearInterval(e)},[]);const p=e=>{const s=atob(e.split(",")[1]),c=new ArrayBuffer(s.length),n=new Uint8Array(c);for(let r=0;r<s.length;r++)n[r]=s.charCodeAt(r);return new Blob([c],{type:"image/jpeg"})};return o("div",{className:"h-screen w-screen bg-slate-800 flex justify-center items-center",children:h("div",{className:"h-1/2 w-1/2 flex flex-col justify-center items-center",children:[o("video",{ref:a,autoPlay:!0,className:"h-full w-full"}),o(S,{}),o("button",{onClick:l,className:"w-100 h-10 bg-green-400 rounded-md active:scale-95",children:"Capture"})]})})};function C(){const a=document.querySelector("#app-container");if(!a)throw new Error("Can not find #app-container");b(a).render(o(A,{}))}C();
